<div *ngIf="udfGroups.length>0 && show">
    <div class="card-hover-shadow-2x mb-1 card">
        <div class="card-header d-flex justify-content-between" data-target="#collapseLoanAnalyses" aria-expanded="true"
            aria-controls="collapseCustomerAccount" (click)="toggleCollapseLoanAnalyses()">
            <div *ngIf="typeUdfLoan">
                <i class="lnr-magnifier text-secondary pr-2"></i>
                {{ 'loan_management.loan_analyses' | translate }}
            </div>
            <div *ngIf="typeUdfCustomer">
                <i class="lnr-magnifier text-secondary pr-2"></i>
                {{ 'customer.customer_analysis' | translate }}
            </div>
            <div>
                <i [ngClass]="(expanded===true)?'lnr-chevron-up text-secondary':'lnr-chevron-down text-secondary'"></i>
            </div>
        </div>
        <div [ngClass]="(expanded===true)?'collapse show':'collapse'" aria-labelledby="headingOne"
            data-parent="#accordionExample">
            <div class="card-body">
                <div class="col-xl-12 d-flex justify-content-end pt-3">
                    <button class="btn-shadow d-inline-flex align-items-center btn btn-primary" type="button"
                        (click)="addUdf()">
                        <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
                        {{'button.add' | translate}}
                    </button>
                </div>
            </div>
                <form [formGroup]="udfForm">
                    <div *ngFor="let udf of listUDFGroups, let j = index">
                        <hr class="solid">
                        <div class="position-relative form-group">
                            <label>{{'udf.udf_group'| translate }} </label>
                            <div class="row no-gutters">
                                <div class="col-xl-6">
                                    <select class="form-control" formControlName="udfGroup{{j}}" [compareWith]="compareGroup" name="udfGroup"
                                        (change)="getUdfFiledList(j, false, null)"
                                        [attr.disabled]="listUDFGroups[j].mondatory? '': null">
                                        <option></option>
                                        <option *ngFor="let udfGroup of udfGroups" [value]="udfGroup.id">
                                            {{udfGroup.description}}
                                        </option>
                                    </select>
                                </div>
                                <div class="col-xl-6 px-3">
                                        <button class="btn btn-danger" (click)="deleteGroupe(j)" *ngIf="!listUDFGroups[j].mondatory">
                                            <i class="pe-7s-trash btn-icon-wrapper text-white"></i>
                                        </button>
                                </div>
                            </div>
                        </div>
                        <div *ngIf="udfFields[j]?.length > 0">
                            <div class="table-responsive mt-2">
                                <div class="container">
                                    <div class="row">
                                      <div class="col-xl-4 col-md-4 mb-3" *ngFor="let udfField of udfFields[j] , let i=index">
                                        <div *ngIf="!udfField.delete">
                                          <label>
                                            {{ udfField.description }}
                                            <span class="text-danger" *ngIf="udfField.mandatory"> *</span>
                                          </label>
                                        </div>
                                        <div *ngIf="udfField.fieldType === 1 ">
                                          <input class="form-control" type="text"
                                            [placeholder]="mascPlacHolder(udfFields[j][i].fieldMasc)"
                                            formControlName="udfField{{j}}{{i}}" name="udfField" />
                                            <div *ngIf="udfForm.get('udfField' + j + i).touched && udfForm.get('udfField' + j + i).invalid">
                                              <small class="text-danger" *ngIf="udfForm.get('udfField' + j + i).errors?.required">{{'This_field_is_required' | translate}}.</small>
                                            </div>
                                        </div>
                                        <div *ngIf="udfField.fieldType === 2">
                                          <input class="form-control" type="number"
                                            [placeholder]="mascPlacHolder(udfFields[j][i].fieldMasc)"
                                            formControlName="udfField{{j}}{{i}}" name="udfField" />
                                            <div *ngIf="udfForm.get('udfField' + j + i).touched && udfForm.get('udfField' + j + i).invalid">
                                              <small class="text-danger" *ngIf="udfForm.get('udfField' + j + i).errors?.required">This field is required.</small>
                                            </div>
                                        </div>
                                        <div *ngIf="udfField.fieldType === 5">
                                          <select class="form-control" [formControlName]="'udfField' + j + i" [compareWith]="compareFieldUDF"
                                            name="udfField" (change)="changeUDFField(j, i)">
                                            <option selected value>
                                              {{'udf.udf_group_code_default_select'| translate }}
                                            </option>
                                            <option *ngFor="let udfFieldListValue of udfField.fieldListValuesDTOs"
                                              [ngValue]="udfFieldListValue">
                                              {{udfFieldListValue.description}}
                                            </option>
                                          </select>
                                          <div *ngIf="udfForm.get('udfField' + j + i).touched && udfForm.get('udfField' + j + i).invalid">
                                            <small class="text-danger" *ngIf="udfForm.get('udfField' + j + i).errors?.required">This field is required.</small>
                                          </div>
                                        </div>
                                        <div *ngIf="udfField.fieldType === 4">
                                          <input type="date" class="form-control"
                                            formControlName="udfField{{j}}{{i}}" name="udfField" />
                                            <div *ngIf="udfForm.get('udfField' + j + i).touched && udfForm.get('udfField' + j + i).invalid">
                                              <small class="text-danger" *ngIf="udfForm.get('udfField' + j + i).errors?.required">This field is required.</small>
                                            </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                            </div>
                            
                        </div>
                    </div>
                </form>
        </div>
    </div>
</div>
