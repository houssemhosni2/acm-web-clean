<div class="accordion mb-1">
  <div class="card">
    <div class="card-header-tab card-header d-flex justify-content-between" data-target="#collapseOne"
      aria-expanded="true" aria-controls="collapseOne" (click)="toggleCollapse()">
      <div class="card-header-title">
        <i class="lnr-user text-secondary px-2"></i>
        {{ 'guarantors.guarantors' | translate }}
      </div>
      <div>
        <i [ngClass]="(expanded===true)?'lnr-chevron-up text-secondary':'lnr-chevron-down text-secondary'"></i>
      </div>
    </div>
    <div id="collapseOne" [ngClass]="(expanded===true)?'collapse show':'collapse'" aria-labelledby="headingOne"
      data-parent="#accordionExample">
      <div class="pb-3 px-2" *ngIf="isApplicationFeeChild">
        <div class="custom-checkbox custom-control">
          <input [checked]="applicationFees !== 0" class="custom-control-input" type="checkbox" disabled>
          <label class="custom-control-label">{{'loan.application_fees_paid'| translate }}</label>
        </div>
      </div>
      <!-- bouton popup-->
      <div class="page-title-actions p-4 d-flex justify-content-end">
        <div class="px-3">
          <button class="btn-shadow d-inline-flex align-items-center btn btn-primary px-3" type="button"
            (click)="addNewGuarantor(content3)">
            <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
            {{'button.add_guarantor' | translate}}
          </button>
        </div>
        <button class="btn-shadow d-inline-flex align-items-center btn btn-primary" type="button"
          (click)="openLarge(content2)">
          <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
          {{'button.select-guarantor' | translate}}
        </button>
      </div>
      <div *ngIf="guarantors.length > 0">
        <div class="p-0">
          <!-- tableau notes -->
          <div class="table-responsive-md">
            <table class="table">
              <thead>
                <tr>
                  <th class="px-5">{{ 'guarantors.name' | translate }}</th>
                  <th>{{ 'customer_management.national_ID' | translate }}</th>
                  <th>{{ 'guarantors.registration_date' | translate }}</th>
                  <th>{{ 'guarantors.amount' | translate }}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <ng-container
                  *ngFor="let item of guarantors | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize, let i = index">
                  <tr *ngIf="item.action !== 'D'">
                    <td class="px-5">{{ item?.customerNameNoPipe }}</td>
                    <td>{{ item?.identity}}</td>
                    <td>{{ item?.customerOpenDate | date : "dd/MM/yyyy" }}</td>
                    <td>
                      <form [formGroup]=guarantorAmount>
                        <input (change)="changedAmountGuarantor(i)" min="0" type="number" class="form-control"
                          formControlName="amount{{i}}">
                      </form>
                    </td>
                    <td>
                      <div class="row d-flex justify-content-end px-3">
                        <div class="col-4 px-1">
                          <button class="btn btn-warning" (click)="GuarantorDetails(item)">
                            <i class="pe-7s-look btn-icon-wrapper text-white"></i>
                          </button>
                        </div>
                        <div class="col-4 px-1">
                          <button class="btn btn-success" (click)="guarantorUpdate(item)">
                            <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
                          </button>
                        </div>
                        <div class="col-4 px-1">
                          <button class="btn btn-danger" (click)='deleteGuarantor(i)'>
                            <i class="pe-7s-trash btn-icon-wrapper text-white"></i>
                          </button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div *ngIf="guarantors.length === 0">
        <div class="card-body">
          <h6 style="color: red;" class="pt-3">{{ 'customer.missing_customer_guarantor' | translate }}</h6>
        </div>
      </div>

      <div class="card-footer pb-0">
        <div class="row no-gutters w-100">
          <div class="col-xl-6 col-lg-6 col-md-12">
            <ngb-pagination [collectionSize]="guarantors.length" [(page)]="page" [pageSize]="pageSize" size="sm"
              [maxSize]="3" [boundaryLinks]="true">
            </ngb-pagination>
          </div>
          <div class="col-xl-6 col-lg-6 col-md-12">
            <div class="d-flex justify-content-lg-end">
              <select class="custom-select" style="width: auto" name="pageSize" [(ngModel)]="pageSize">
                <option [ngValue]="5">{{'pagination.5_item'| translate }}</option>
                <option [ngValue]="10">{{'pagination.10_item'| translate }}</option>
                <option [ngValue]="20">{{'pagination.20_item'| translate }}</option>
                <option [ngValue]="50">{{'pagination.50_item'| translate }}</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<ng-template #content let-c="close" let-d="dismiss">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
    <div class="card">
      <div class="card-header py-2">
        <div [style]="{width : '97%'}">
          <h4 class="modal-title fw-bold">{{'customer.guarantor'| translate }}</h4>
        </div>
        <div [style]="{width : '3%'}">
          <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
            (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
      <div class="card-body">
      </div>
      <div class="card-footer py-2 d-flex justify-content-end">
        <button class="mb-2 mx-2 btn btn-outline-danger" (click)="c('close')">{{'button.cancel' | translate}}</button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #content2 let-c="close" let-d="dismiss">
  <div class="main-card card">
    <div class="card-header py-2">
      <div [style]="{width : '97%'}">
        <h4 class="modal-title fw-bold">{{'customer.guarantor'| translate }}</h4>
      </div>
      <div [style]="{width : '3%'}">
        <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
          (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

    </div>
    <app-customer-search [guarantor]="true" [guarantors]="guarantors" [categoryCustomerLink]="customerLinkCategoryParam"
      (selectedCustomer)="addCustomer($event)"></app-customer-search>
  </div>
</ng-template>
<ng-template #content3 let-c="close" let-d="dismiss">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
    <div class="card">
      <div class="card-header py-2">
        <div [style]="{width : '97%'}">
          <h4 class="modal-title fw-bold">{{'customer.save_guarantor'| translate }}</h4>
        </div>
        <div [style]="{width : '3%'}">
          <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
            (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
      <div class="card-body">
        {{'customer.please_save_changes'| translate }}
      </div>
      <div class="card-footer py-2 d-flex justify-content-end">
        <button class="mb-2 mx-2 btn btn-outline-danger" (click)="c('close')">{{'button.cancel' | translate}}</button>
      </div>
    </div>
  </div>
</ng-template>