<app-page-title [heading]="'sidebar.loan_application'| translate " [icon]="'pe-7s-note2'" [account]="loan.accountNumber"
  [status]="loan.statutWorkflow" [loanApplicationStatus]="loan?.loanApplicationStatus"></app-page-title>
<div class="row">
  <div class="col-md-9 col-xl-9 px-1">
    <app-customer [expanded]="false"></app-customer>
    <app-screening [expandedCustomerScreening]="true" [expandedGuanatorsScreening]="true" (echec)="getStatus($event)"
      (buttonNextStepCustomerAML)="getButtonNextStepCustomerAML($event)" (buttonNextStepGuarantorAML)="getButtonNextStepGuarantorAML($event)"
      (buttonNextStepCustomerIScore)="getButtonNextStepCustomerIScore($event)" (buttonNextStepGuarantorIScore)="getButtonNextStepGuarantorIScore($event)">
    </app-screening>
    <app-upload-item  [saveFilesAction]="saveFilesAction" (lengthDocuments)="receiveLengthDocuments($event)" [category]="categoryLoan"
    [originSource]="originSource" [expanded]="true" (saveDone)="saveDocumentsDone($event)" (checkRequiredDoc)="checkRequiredDocumentParent($event)"
    >
    </app-upload-item>
    <app-udf-step-workflow [source]="'workflow'" [category]="'LOAN'"></app-udf-step-workflow>
    <div class="d-block text-end pt-2">
      <button class="mb-2 mx-2 btn btn-outline-danger" (click)="exit()">{{'button.exit' | translate}}</button>
      <button class="mb-2 mx-2 btn btn-secondary text-white" *ngIf="loan.parentId === 0 && loan.isOwnerOrValidator"
        (click)="previousStep()">{{'button.previous' | translate}}</button>
      <button *ngIf="!loanSharedService.habilitationButton('REJECT',currentPath) && loan.parentId === 0 && loan.isOwnerOrValidator" class="mb-2 mx-2 btn btn-danger" [disabled]="!echec"
        (click)="rejectModal(content1)">{{'button.reject' | translate}}</button>
      <button class="mb-2 btn btn-success mx-2" (click)="saveUdfs()" [disabled]="isOfflineModeEnabled()">{{'button.save'| translate }}</button>
      <button class="mb-2 btn btn-primary" *ngIf="loan.parentId === 0 && fieldVisitCheck"
        (click)="nextStep()" [disabled]="checkNextStep()" >{{'button.next' | translate}}</button>
      <!-- Child Loan Review -->
      <button class="mb-2 mx-2 btn btn-primary"
              *ngIf="loan.parentId !== 0"
              (click)="nextStep()" [disabled]="checkNextStep() ">
        {{'button.next' | translate}} </button>
      <!-- Child Loan Review -->
      <button class="mb-2 mx-2 btn btn-secondary text-white" *ngIf="loan.parentId !== 0 && loan.statutWorkflow === 16"
        (click)="previousStep()">{{'button.previous' | translate}}</button>


        <button class="mb-2 mx-2 btn btn-success"
        *ngIf="!loanSharedService.habilitationButton('NEXT',currentPath) && loan.parentId === 0 && loan.isOwnerOrValidator"
        (click)="submitStep()" [disabled]="checkNextStep() || isOfflineModeEnabled()">{{'button.submit' | translate}}</button>
        <!-- Execute Api -->
      <button class="mb-2 mx-2 btn btn-primary "
      *ngIf=" displayButtonExecuteApi && (!loanSharedService.habilitationButton('EXECUTE_API',currentPath) && loan.isOwnerOrValidator)"
      type="submit" (click)="executeThirdPartyApi()" >{{('Execute_api'|translate)}} </button>
    </div>
  </div>
  <div class="col-md-3 col-xl-3 px-1">
    <app-loan-process [etapeProcess]="currentStatus"></app-loan-process>
  </div>
</div>
<ng-template #content1 let-c="close" let-d="dismiss">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
    <form class="position-relative col-xl-12 px-0 col-md-12" [formGroup]="rejectForm" (ngSubmit)="onSubmit()">
      <div class="modal-header py-2">
        <h4 class="modal-title">{{'reject.reject_loan'| translate }}</h4>
        <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
          (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body row no-gutters">
        <div class="position-relative col-xl-12 col-md-12">
          <label>{{'reject.reject_reason'| translate }}</label>
          <select class="form-control" formControlName="reason">
            <option selected value> </option>
            <option *ngFor="let settingMotifRejetsEntity of settingMotifRejetsEntitys"
              [ngValue]="settingMotifRejetsEntity">
              {{settingMotifRejetsEntity.libelle}}
            </option>
          </select>
        </div>
        <div class="position-relative col-xl-12 col-md-12">
          <label> {{'reject.note'| translate }} </label>
          <textarea class="form-control" formControlName="note"></textarea>
        </div>
        <div class="position-relative form-group">
          <div>
            <div class="custom-checkbox custom-control">
              <input class="custom-control-input" id="exampleCustomCheckboxReject" type="checkbox"
                formControlName="confirm" (change)="changeChecboxReject()">
              <label class="custom-control-label ms-2" for="exampleCustomCheckboxReject">{{'button.confirm_checkbox' |
                translate}}</label>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer py-1">
        <button type="button" class="btn btn-outline-danger" (click)="c('Close click')">{{'button.close' |
          translate}}</button>
        <button type="submit" class="btn btn-danger">{{'button.reject' | translate}}</button>
      </div>
    </form>
  </div>
</ng-template>
