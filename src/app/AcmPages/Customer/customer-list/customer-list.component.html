<!--title-->
<app-page-title *ngIf="mode !== '5' && mode !== '4' && !fromSupplier360"
  [heading]="'customer.search_customer'| translate " [icon]="'pe-7s-search'" [account]="''"
  [status]="-1"></app-page-title>
<app-page-title *ngIf="mode === '4' && !fromSupplier360" [heading]="'customer_aml.aml_check'| translate "
  [icon]="'pe-7s-search'" [account]="''" [status]="-1"></app-page-title>
<app-page-title *ngIf="mode === '5' && !fromSupplier360" [heading]="'customer.prospect'| translate "
  [icon]="'pe-7s-search'" [account]="''" [status]="-1"></app-page-title>
<div class="main-card card"  [ngStyle]="{ 'margin-bottom': mode === '6' ? '7.5rem' : '1.5rem' }">
  <div class="card-body">
    <p-table *ngIf="isOfflineModeEnabled()" #dt [responsive]="true" [autoLayout]=true
      [value]="customerPaginationEntity.resultsCustomers" [lazy]="false" [lazyLoadOnInit]="false" sortMode="multiple"
      [totalRecords]="customerPaginationEntity.totalElements" [rowsPerPageOptions]="[5,10,20,50,100]" [paginator]="true"
      [pageLinks]="5" [rows]="10" [columns]="selectedColumns" [showCurrentPageReport]="true" [(selection)]="customer"
      selectionMode="single">
      <ng-template pTemplate="header" let-columns>
        <tr>
          <!-- actions button -->
          <th *ngFor="let col of columns" [pSortableColumn]="col.field" class="text-center">
            <div class="center-elem text-center">
              {{col.header | translate}}
              <p-sortIcon [field]="col.field" class="pl-1"></p-sortIcon>
            </div>
          </th>
          <th style='width: 40px;'></th>
        </tr>
        <tr>
          <th *ngFor="let col of columns" [ngSwitch]="col.field">

            <select *ngSwitchCase="'customerType'" class="form-control"
              (change)="dt.filter($event.target.value, col.field, 'equals')">
              <option value="null">{{'category_loan.all' | translate}}</option>
              <option *ngIf="mode !='5'" value="INDIV">{{'category_customer.individual' | translate}}</option>
              <option *ngIf="mode !='5'" value="ORG">{{'category_customer.organisation' | translate}}</option>
              <option *ngIf="mode !='5'" value="GRP">{{'category_customer.groupe' | translate}}</option>
              <option value="PROSPECT">{{'category_customer.prospect' | translate}}</option>
            </select>
            <input *ngSwitchCase="'customerNumber'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'customerNameNoPipe'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'branchesName'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'identity'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'solidarityName'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'accountPortfolioDescription'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'dateInsertion'" class="form-control ACM-Dashbord-Date-col" type="date"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
          </th>
          <th style='width: 40px;'></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-loans let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData">
          <td *ngFor="let col of columns" [ngSwitch]="col.field" class="text-center">
            <div *ngSwitchCase="'customerType'">
              <div *ngIf="rowData[col.field] === 'INDIV'">
                <i class="lnr-user"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'GRP'">
                <i class="lnr-users"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'ORG'">
                <i class="lnr-apartment"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'PROSPECT'">
                <i class="lnr-flag"> </i>
              </div>
            </div>
            <div *ngSwitchCase="'customerNumber'">{{rowData[col.field]}}</div>
            <div class="text-left" *ngSwitchCase="'customerNameNoPipe'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'identity'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'solidarityName'">
              <div *ngIf="rowData['customerType'] === 'INDIV'">
                {{rowData[col.field]}}</div>
            </div>
            <div *ngSwitchCase="'branchesName'">{{rowData[col.field]}}</div>
            <div class="text-left" *ngSwitchCase="'accountPortfolioDescription'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'dateInsertion'">{{rowData[col.field] | date: 'dd/MM/yyyy'}}</div>
            <div *ngSwitchCase="'amlStatus'">
              <div *ngIf="!sharedService.habilitationButton('AML_DETAILS',currentPath) && mode === '4'">
                <button class="btn btn-sm btn-primary" ngbTooltip="{{'customer_aml.details'| translate }}"
                  (click)="detailsAmlCustomer(content,rowData )">
                  <i class="pe-7s-more btn-icon-wrapper text-white"></i>
                </button>
              </div>

            </div>

          </td>
          <td *ngIf="!sharedService.habilitationButton('CUSTOMER_360',currentPath) && mode === '1'">
            <button class="btn btn-warning" (click)="customerDetails(rowData)">
              <i class="pe-7s-look btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('SUBMIT',currentPath) && mode === '3'">
            <button class="btn btn-primary" (click)="addLoanForCustomer(rowData)">
              <i class="pe-7s-plus btn-icon-plus text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('UPDATE',currentPath) && (mode === '2')">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE')">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('CHECK_AML',currentPath) && mode === '4'">
            <button class="btn btn-sm btn-success" ngbTooltip="{{'customer_aml.run'| translate }}"
              (click)="runAmlCustomer(rowData)">
              <i class="pe-7s-play btn-icon-wrapper text-white"></i>
            </button>
          </td>

          <td *ngIf="!sharedService.habilitationButton('UPDATE_ALL',currentPath) && mode === '2'">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE_ALL')">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="mode === '5'">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE_ALL')">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <p-table *ngIf="!isOfflineModeEnabled()" #dt [responsive]="true" [autoLayout]=true
      [value]="customerPaginationEntity.resultsCustomers" (onLazyLoad)="reloadCustomerList($event)" [lazy]="true"
      [lazyLoadOnInit]="false" sortMode="multiple" [totalRecords]="customerPaginationEntity.totalElements"
      [rowsPerPageOptions]="[5,10,20,50,100]" [paginator]="true" [pageLinks]="5" [rows]="10" [columns]="selectedColumns"
      [showCurrentPageReport]="true" [(selection)]="currentSelection" [selectionMode]='mode === "6" ? "multiple": "single"'>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <!-- actions button -->
          <th class="ACM_Customer_Search_void_Col" *ngIf="mode === '6'"></th>
          <th *ngFor="let col of columns" [pSortableColumn]="col.field" class="text-center">
            <div class="center-elem text-center">
              {{col.header | translate}}
              <p-sortIcon [field]="col.field" class="pl-1"></p-sortIcon>
            </div>
          </th>
          <th *ngIf="mode === '4'">
            <div class="center-elem text-center">
              {{ 'aml_profile_details.aml_reason' | translate}}
            </div>
          </th>
          <th style='width: 40px;'></th>
          <th style='width: 40px;'></th>
        </tr>
        <tr>
          <th class="ACM_Customer_Search_void_Col" *ngIf="mode === '6'">
            <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
          </th>
          <th *ngFor="let col of columns" [ngSwitch]="col.field">

            <select *ngSwitchCase="'customerType'" class="form-control"
              (change)="dt.filter($event.target.value, col.field, 'equals')">
              <option value="null">{{'category_loan.all' | translate}}</option>
              <option *ngIf="mode !='5'" value="INDIV">{{'category_customer.individual' | translate}}</option>
              <option *ngIf="mode !='5'" value="ORG">{{'category_customer.organisation' | translate}}</option>
              <option *ngIf="mode !='5'" value="GRP">{{'category_customer.groupe' | translate}}</option>
              <option *ngIf="mode ==='5'" value="PROSPECT">{{'category_customer.prospect' | translate}}</option>
            </select>
            <input *ngSwitchCase="'customerNumber'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'customerNameNoPipe'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'branchesName'" class="form-control placeholder" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'identity'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'solidarityName'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'accountPortfolioDescription'" class="form-control" type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <input *ngSwitchCase="'dateInsertion'" class="form-control ACM-Dashbord-Date-col" type="date"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            <select *ngSwitchCase="'amlStatus'" class="form-control ACM-Dashbord-Date-col" type="text"
              (input)="dt.filter($event.target.value, col.field, 'equals')">
              <option value="">{{'category_loan.all' | translate}}</option>
              <option *ngFor="let state of amlStatusList" value="{{state}}">{{state}}</option>
            </select>

          </th>
          <th *ngIf="mode === '4'"></th>
          <th style='width: 40px;'></th>
          <th style='width: 40px;'></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-loans let-rowData let-columns="columns">
        <tr [pSelectableRow]="rowData">
          <td *ngIf="mode === '6'">
            <div (click)="$event.stopPropagation()">
            <p-tableCheckbox  [value]="rowData"></p-tableCheckbox>
            </div>
          </td>
          <td *ngFor="let col of columns" [ngSwitch]="col.field" class="text-center">
            <div *ngSwitchCase="'customerType'">
              <div *ngIf="rowData[col.field] === 'INDIV'">
                <i class="lnr-user"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'GRP'">
                <i class="lnr-users"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'ORG'">
                <i class="lnr-apartment"> </i>
              </div>
              <div *ngIf="rowData[col.field] === 'PROSPECT'">
                <i class="lnr-flag"> </i>
              </div>
            </div>
            <div *ngSwitchCase="'customerNumber'">{{rowData[col.field]}}</div>
            <div class="text-left" *ngSwitchCase="'customerNameNoPipe'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'identity'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'solidarityName'">
              <div *ngIf="rowData['customerType'] === 'INDIV'">
                {{rowData[col.field]}}</div>
            </div>
            <div *ngSwitchCase="'branchesName'">{{rowData[col.field]}}</div>
            <div class="text-left" *ngSwitchCase="'accountPortfolioDescription'">{{rowData[col.field]}}</div>
            <div *ngSwitchCase="'dateInsertion'">{{rowData[col.field] | date: 'dd/MM/yyyy'}}</div>

            <div *ngSwitchCase="'amlStatus'">
              <div *ngIf="!sharedService.habilitationButton('AML_DETAILS',currentPath) && mode === '4'">
                <div *ngFor="let amlCheck of rowData.acmAmlChecksDTOs">
                  <div *ngIf="amlCheck.amlStatus==='CLEARED'" class="badge bg-success ng-star-inserted"
                    style="margin: 2px;">
                    {{'customer.not' | translate}} {{amlCheck.listName}}
                  </div>
                  <div *ngIf="amlCheck.amlStatus==='FLAGGED'" class="badge bg-danger ng-star-inserted"
                    style="margin: 2px;">
                    {{'customer.confirmed' | translate}} {{ amlCheck.listName}}
                  </div>
                  <div *ngIf="amlCheck.amlStatus==='PENDING'" class="badge bg-warning ng-star-inserted"
                    style="margin: 2px;">
                    {{'pending' | translate }} {{amlCheck.listName}}
                  </div>
                  <div
                    *ngIf="amlCheck.amlStatus!=='PENDING' && amlCheck.amlStatus!=='SAFE' && amlCheck.amlStatus!=='FLAGGED'">
                  </div>
                </div>
              </div>
            </div>
          </td>
          <td *ngIf="mode === '4'">
            <app-aml-profile-descriptions [acmAmlChecksDTOs]="rowData.acmAmlChecksDTOs"></app-aml-profile-descriptions>
          </td>
          <td *ngIf="isExistAmlDetails(rowData) && mode === '4'">
            <button class="btn btn-warning" (click)="getAmlData(content,rowData )">
              <i class="pe-7s-more btn-icon-wrapper text-white" style="font-size: 8px;"></i>
            </button>
          </td>
          <td *ngIf="!isExistAmlDetails(rowData) && mode === '4'"></td>
          <td *ngIf="!sharedService.habilitationButton('CUSTOMER_360',currentPath) && mode === '1'">
            <button class="btn btn-warning" (click)="customerDetails(rowData)">
              <i class="pe-7s-look btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('SUBMIT',currentPath) && mode === '3'">
            <button class="btn btn-primary" (click)="addLoanForCustomer(rowData)">
              <i class="pe-7s-plus btn-icon-plus text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('UPDATE',currentPath) && (mode === '2')">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE')">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="!sharedService.habilitationButton('CHECK_AML',currentPath) && mode === '4'">
            <button class="btn btn-sm btn-success" ngbTooltip="{{'customer_aml.run'| translate }}"
              (click)="checkAmlCustomer(rowData)">
              <i class="pe-7s-play btn-icon-wrapper text-white"></i>
            </button>
          </td>

          <td *ngIf="!sharedService.habilitationButton('UPDATE_ALL',currentPath) && mode === '2'">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE_ALL')">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
          <td *ngIf="mode === '5'">
            <button class="btn btn-success" (click)="customerUpdate(rowData,'UPDATE_ALL')">
              {{'button.convertirCustomer'| translate}}
            </button>
          </td>
          <td *ngIf="mode === '5'">
            <button class="btn btn-success" (click)="prospectUpdate(rowData)">
              <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
            </button>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <div class="text-center opacity-6 pt-1 pb-0">
      <b> {{'dashboard.total' | translate}} {{customerPaginationEntity.totalElements}} </b>
    </div>
  </div>
</div>

<ng-template #content let-c="close" let-d="dismiss">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
    <div class="modal-header py-2">
      <h4 class="modal-title">{{'button.details'| translate }}</h4>
      <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
        (click)="closeAmlDetails()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body" *ngIf="amlDetails">
      <div class="main-card mb-3 card">
        <div class="card-body">
          <app-aml-profile-informtion [gender]="amlDetails?.mapRecord?.Gender"
            [type]="amlDetails?.mapRecord?.recordType" [nameDetails]="amlDetails?.mapRecord?.NameDetails"
            [descriptions]="amlDetails?.mapRecord?.Descriptions" [dateDetails]="amlDetails?.mapRecord?.DateDetails"
            [images]="amlDetails?.mapRecord?.Images"></app-aml-profile-informtion>
        </div>
      </div>
      <div class="tabs-animated tabs-animated-shadow tabs-rounded-lg card">
        <ul class="nav nav-tabs nav-justified">
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': detailsTab}" (click)="changeTab(1)">
              <span style="font-size: medium;">{{ 'aml_profile_details.details' | translate}}</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': sanctionsListTab}" (click)="changeTab(2)">
              <span style="font-size: medium;">{{ 'aml_profile_details.sanctions_list' | translate}}</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': identityTab}" (click)="changeTab(3)">
              <span style="font-size: medium;">{{ 'aml_profile_details.identity' | translate}}</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': functionsTab}" (click)="changeTab(4)">
              <span style="font-size: medium;">{{ 'aml_profile_details.functions' | translate}}</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': noteTab}" (click)="changeTab(5)">
              <span style="font-size: medium;">{{ 'aml_profile_details.note' | translate}}</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [ngClass]="{'active': sourcesTab}" (click)="changeTab(6)">
              <span style="font-size: medium;">{{ 'aml_profile_details.sources' | translate}}</span>
            </a>
          </li>
        </ul>
      </div>

      <div *ngIf="detailsTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-details [descriptions]="amlDetails?.mapRecord?.Descriptions"
            [expanded]="true"></app-aml-profile-details>
        </div>
      </div>
      <div *ngIf="sanctionsListTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-sanctions-references [sanctionsReferences]="amlDetails?.mapRecord?.SanctionsReferences"
            [expanded]="true"></app-aml-profile-sanctions-references>
        </div>
      </div>
      <div *ngIf="identityTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-identity [iDNumberTypes]="amlDetails?.mapRecord?.IDNumberTypes"
            [expanded]="true"></app-aml-profile-identity>
        </div>
      </div>
      <div *ngIf="functionsTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-function [roleDetail]="amlDetails?.mapRecord?.RoleDetail"
            [expanded]="true"></app-aml-profile-function>
        </div>
      </div>
      <div *ngIf="noteTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-note [profileNotes]="amlDetails?.mapRecord?.ProfileNotes"
            [expanded]="true"></app-aml-profile-note>
        </div>
      </div>
      <div *ngIf="sourcesTab">
        <div class="main-card mb-3 card">
          <app-aml-profile-sources [sourceDescription]="amlDetails?.mapRecord?.SourceDescription"
            [expanded]="true"></app-aml-profile-sources>
        </div>
      </div>
      <div class="main-card mb-3 card">
        <app-aml-workflow-details [acmAmlChecksDTOs]="acmAmlChecksDTOs"
          (dismissModal)="dismissModal($event)"></app-aml-workflow-details>
      </div>

    </div>
    <div class="modal-footer py-1">
      <button type="button" class="btn btn-outline-danger" (click)="closeAmlDetails()">{{'button.close' |
        translate}}</button>
    </div>
  </div>
</ng-template>