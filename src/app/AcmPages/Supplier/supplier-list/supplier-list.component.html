<!--title-->
<app-page-title *ngIf="!search && mode != 1 " [heading]="'supplier.search'| translate " [icon]="'pe-7s-id'"
    [account]="''" [status]="-1"></app-page-title>

<app-page-title *ngIf="!search && mode == 1 " [heading]="'supplier-360.supplier_360_hearder' | translate"
    [icon]="'pe-7s-users'" [account]="''" [status]="-1"></app-page-title>

<div class="main-card mb-3 card">
    <div class="card-body">
        <p-table #dt [responsive]="true" [autoLayout]=true [value]="supplierPaginationEntity.resultsSuppliers"
            (onLazyLoad)="reloadSupplierList($event)" [lazy]="true" [lazyLoadOnInit]="false" sortMode="multiple"
            [totalRecords]="supplierPaginationEntity.totalElements" [rowsPerPageOptions]="[5,10,20,50,100]"
            [paginator]="true" [pageLinks]="5" [rows]="10" [columns]="selectedColumns" [showCurrentPageReport]="true"
            [(selection)]="supplier" selectionMode="single">

            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th style='width: 40px;' *ngIf="search"></th>
                    <!-- actions button -->
                    <th *ngFor="let col of columns" [pSortableColumn]="col.field" class="text-center">
                        <div class="center-elem text-center">
                            {{col.header | translate}}
                            <p-sortIcon [field]="col.field" class="pl-1"></p-sortIcon>
                        </div>
                    </th>

                    <th style='width: 80px;'></th>
                    <th style='width: 80px;'></th>
                </tr>
                <tr>
                    <th class="ACM_Customer_Search_void_Col" *ngIf="search">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th *ngFor="let col of columns" [ngSwitch]="col.field">

                        <input *ngSwitchCase="'id'" class="form-control placeholder" type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')" >

                        <input *ngSwitchCase="'name'" class="form-control ACM-Dashbord-customername-col" type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">
                        <input *ngSwitchCase="'registerNumber'" class="form-control" type="number" min="0" step="50"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">


                        <select *ngSwitchCase="'activityName'" class="form-control ACM-Dashbord-productDescription-col"
                            (change)="dt.filter($event.target.value, col.field, 'equals')" [showClear]="true">
                            <option value="null">{{'category_loan.all' | translate}}</option>
                            <option *ngFor="let s of sectorList" [ngValue]="s">
                                {{s}}
                            </option>

                        </select>



                        <select *ngSwitchCase="'status'" class="form-control ACM-Dashbord-customername-col"
                            (change)="dt.filter($event.target.value, col.field, 'equals')">
                            <option value="null">{{'category_loan.all' | translate}}</option>
                            <option value="POTENTIEL">{{ 'supplier.supplier_status_potentiel' | translate }}</option>
                            <option value="APPROVED">{{ 'supplier.supplier_status_approved' | translate }}</option>
                            <option value="REJECTED">{{ 'supplier.supplier_status_rejected' | translate }}</option>
                            <option value="NON CONTRACTED">{{ 'supplier.supplier_status_non_contracted' | translate }}</option>

                            <!-- <option value="2">Personne morale</option> -->
                        </select>
                        <input *ngSwitchCase="'objectif'" class="form-control ACM-Dashbord-customername-col" type="number" min="0" step="50"
                            (input)="dt.filter($event.target.value, col.field, 'contains')" >
                        <input *ngSwitchCase="'balanceSupplier'" class="form-control ACM-Dashbord-customername-col" type="number" min="0" step="50"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">
                        <input *ngSwitchCase="'insertBy'" class="form-control ACM-Dashbord-customername-col" type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">
                        <input *ngSwitchCase="'dateInsertion'" class="form-control ACM-Dashbord-customername-col"
                            type="date" (input)="dt.filter($event.target.value, col.field, 'contains')">
                    </th>
                    <th style='width: 40px;'></th>
                    <th style='width: 40px;'></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-loans let-rowData let-columns="columns">
                <tr [pSelectableRow]="rowData">
                    <td *ngIf="search">
                        <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
                    </td>
                    <td *ngFor="let col of columns" [ngSwitch]="col.field" class="text-center">


                        <div *ngSwitchCase="'id'">{{rowData[col.field]}}</div>
                        <div *ngSwitchCase="'name'">{{rowData[col.field]}}</div>

                        <div *ngSwitchCase="'activityName'">{{rowData[col.field]}}</div>
                        <div *ngSwitchCase="'status'" class="page-title-subheading">
                            <div class="badge bg-warning" *ngIf="rowData[col.field] === 'POTENTIEL'">
                                {{ 'supplier.supplier_status_potentiel' | translate }}
                            </div>
                            <div class="badge bg-danger" *ngIf="rowData[col.field] === 'REJECTED'">
                                {{ 'supplier.supplier_status_rejected' | translate }}
                            </div>
                            <div class="badge bg-success" *ngIf="rowData[col.field] === 'APPROVED'">
                                {{ 'supplier.supplier_status_approved' | translate }}
                            </div>
                            <div class="badge bg-success" *ngIf="rowData[col.field] === 'NON CONTRACTED'">
                                {{ 'supplier.supplier_status_non_contracted' | translate }}
                            </div>
                        </div>
                        <div *ngSwitchCase="'objectif'">{{rowData[col.field]| number: this.decimalPlaces:'fr'}}</div>
                        <div *ngSwitchCase="'balanceSupplier'">{{rowData[col.field]| number: this.decimalPlaces:'fr'}}</div>
                        <!-- </div> -->
                        <div *ngSwitchCase="'insertBy'">{{rowData[col.field]}}</div>

                        <div *ngSwitchCase="'dateInsertion'">
                            {{rowData[col.field] | date: 'dd/MM/yyyy'}} </div>
                    </td>

                    <td>
                        <button class="btn btn-success" (click)="redirectTo(rowData)">
                            <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
                        </button>
                    </td>
                    <td>
                        <button class="btn btn-warning" (click)="supplierDetails(rowData)">
                          <i class="pe-7s-look btn-icon-wrapper text-white"></i>
                        </button>
                      </td>
                </tr>
            </ng-template>
        </p-table>

        <div class="text-center opacity-6 pt-1 pb-0">
            <b> {{'dashboard.total' | translate}} {{supplierPaginationEntity.totalElements}} </b>
        </div>
    </div>
</div>
<div class="card-footer py-2 d-flex justify-content-end" *ngIf="search">
    <button class="mb-1 mx-2 btn btn-outline-danger" (click)="closeModale()">{{'button.cancel' | translate}}</button>
    <button class="mb-1 btn btn-primary" (click)='addSupplier(supplier)'>{{'button.save'| translate }}</button>

</div>
