<div class="accordion mb-1" id="accordionExample">
  <div class="card">
    <div class="card-header d-flex justify-content-between" id="headingOne" data-target="#collapseCustomerNote"
      aria-expanded="true" aria-controls="collapseCustomerNote" (click)="toggleCollapse()">
      <div>
        <i class="vsm-icon pe-7s-date fa-lg px-2"></i>
        {{'task.tasks' | translate}}
      </div>
    </div>
    <div id="collapseCustomerNote" [ngClass]="(expanded===true)?'collapse show':'collapse'"
      aria-labelledby="headingOne">
      <div *ngIf="eventList.length > 0">
        <div class="card-body">
          <!-- bouton popup-->
          <div class="page-title-actions mb-3 d-flex justify-content-end"
            *ngIf="(collection || (loan && loan.statutWorkflow!== 14 && loan.statutWorkflow!==15  && loan.statutWorkflow!== 17))|| item!=undefined|| source === 'CLAIM'"
            >
            <button class="btn-shadow d-inline-flex align-items-center btn btn-primary" type="button"
              (click)="openLarge(content)">
              <fa class="mx-2" name="plus" _nghost-gyt-c2="" ng-reflect-name="plus">
                <i _ngcontent-gyt-c2="" aria-hidden="true" class="fa fa-plus" ng-reflect-klass="fa fa-plus"
                  ng-reflect-ng-class=""></i>
              </fa>
              {{'button.add' | translate}}
            </button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="mb-0 table green">
            <thead>
              <tr>
                <th>{{'task.start_date'| translate }}</th>
                <th *ngIf="source !=='CLAIM'" class="text-center">{{'step'| translate}}</th>
                <th>{{'customer_decision.addedBy'| translate }}</th>
                <th>{{'task.to_user'| translate }}</th>
                <th>{{'task.title'| translate }}</th>
                <th>{{'task.description'| translate }} </th>
                <th class="text-center">{{'dashboard.status'| translate }}</th>
                <th class="text-center"></th>
                <th>{{'button.details'| translate }}</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let event of eventList | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize; let i = index ">
                <td class="ACM-table-historyNote-td-1">
                  {{event.dateDebut | date: 'dd/MM/yyyy hh:mm a'}}
                </td>
                <td class="ACM-table-historyNote-td-3 text-center" *ngIf="source !=='CLAIM'" >
                  <div class="badge bg-info ng-star-inserted">
                    {{event.stepName}}
                  </div>
                </td>
                <td class="ACM-table-historyNote-td-2">
                  {{event.insertBy}}
                </td>
                <td class="ACM-table-historyNote-td-2">
                  {{event.userFullName}}
                </td>
                <td class="ACM-table-historyNote-td-2">
                  {{event.libelleEvent}}
                </td>
                <td class="ACM-table-historyNote-td-2">
                  {{displayDescription(event.description)}}
                </td>
                <td class="ACM-table-historyNote-td-3 text-center">
                  <div *ngIf="event.statut === 'New'" class="badge bg-primary ng-star-inserted">
                    {{event.statut}}
                  </div>
                  <div *ngIf="event.statut === 'CLOSED'" class="badge bg-success ng-star-inserted">
                    {{event.statut}}
                  </div>
                </td>
                <td class="ACM-table-historyNote-td-5 text-center">
                  <button *ngIf="connectedUser.login === event.username && event.statut === 'New'"
                    class="btn btn-shadow btn-success " (click)="completeEvent(event)">
                    {{'button.done'| translate }} </button>
                </td>
                <td class="ACM-table-historyNote-td-5 text-center">
                  <button class="btn btn-shadow btn-primary " (click)="displayDetailsDescription(event, content6)">
                    <i class="pe-7s-more btn-icon-wrapper"></i>
                  </button>
                </td>

              </tr>
            </tbody>
          </table>
        </div>
        <div class="card-footer pb-2">
          <div class="row no-gutters w-100">
            <div class="col-xl-6 col-lg-6 col-md-12">
              <ngb-pagination [collectionSize]="eventList.length" [(page)]="page" [pageSize]="pageSize" size="sm"
                [maxSize]="3" [boundaryLinks]="true">
              </ngb-pagination>
            </div>
            <div class="col-xl-6 col-lg-6 col-md-12">
              <div class="d-flex justify-content-lg-end">
                <select class="custom-select" style="width: auto" name="pageSize" [(ngModel)]="pageSize">
                  <option selected [ngValue]="5">{{'pagination.5_item'| translate }}</option>
                  <option [ngValue]="10">{{'pagination.10_item'| translate }}</option>
                  <option [ngValue]="20">{{'pagination.20_item'| translate }}</option>
                  <option [ngValue]="50">{{'pagination.50_item'| translate }}</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="eventList.length === 0">
        <div class="card-body">
          <div class="page-title-actions mb-3 d-flex justify-content-end"
            *ngIf="(collection || ( loan && loan.statutWorkflow!== 14 && loan.statutWorkflow!==15  && loan.statutWorkflow!== 17))|| item!=undefined || source === 'CLAIM'">
            <button class="btn-shadow d-inline-flex align-items-center btn btn-primary" type="button"
              (click)="openLarge(content)">
              <fa class="mx-2" name="plus" _nghost-gyt-c2="" ng-reflect-name="plus">
                <i _ngcontent-gyt-c2="" aria-hidden="true" class="fa fa-plus" ng-reflect-klass="fa fa-plus"
                  ng-reflect-ng-class=""></i>
              </fa>
              {{'button.add' | translate}}
            </button>
          </div>
          <h6 style="color: red;" class="pt-3">{{ 'task.no_tasks' | translate }}</h6>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #content let-close="close">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
    <div class="modal-header py-2">
      <h5 class="modal-title">{{ 'task.new_task' | translate }}</h5>
      <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" (click)="close()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="card-body">
      <form class="form" [formGroup]="eventForm">
        <div class="position-relative">
          <label> {{'task.title'| translate }}</label>
          <span class="text-danger">*</span>
          <div class="input-group">
            <input type="text" class="form-control" formControlName="title">
          </div>
        </div>
        <br>
        <div class="position-relative">
          <label> {{'task.user'| translate }}</label>
          <span class="text-danger">*</span>
          <ngx-select-dropdown tabindex="0" formControlName="user" [multiple]="false" [options]="users"
            [config]="configUsers"></ngx-select-dropdown>
        </div>
        <br>
        <br>
        <div class="position-relative">
          <label> {{'task.start_date'| translate }}</label>
          <span class="text-danger">*</span>
          <div class="input-group">
            <input type="date" class="form-control" [min]="minDate" formControlName="startDate">
            <input type="time" class="form-control" formControlName="startHour">
          </div>
        </div>
        <br>
        <div class="position-relative">
          <label> {{'task.end_date'| translate }}</label>
          <span class="text-danger">*</span>
          <div class="input-group">
            <input type="date" class="form-control" [min]="eventForm.controls.startDate.value" formControlName="endDate"
              (change)="dateChanged()">
            <input type="time" class="form-control" formControlName="endHour">
          </div>
        </div>
        <div class="position-relative ">
          <label>{{'task.participant'| translate }}</label>
          <ngx-select-dropdown tabindex="0" formControlName="participant" [multiple]="true" [options]="users"
            [config]="configUsers" (change)="participantMethod()"></ngx-select-dropdown>
        </div>
        <br>
        <div class="position-relative">
          <label> {{'task.description'| translate }}</label>
          <div class="input-group">
            <textarea rows="3" cols="20" pInputTextarea class="form-control" formControlName="description">
            </textarea>
          </div>
        </div>
        <div class="modal-footer py-1 pt-2">
          <button class="mb-2 mx-2 btn btn-outline-danger" type="reset" (click)="reset()">{{'button.cancel' |
            translate}}</button>
          <button class="mb-2 btn btn-primary" (click)="onSubmit()">{{'button.save' | translate}}</button>
        </div>
      </form>
    </div>
  </div>
</ng-template>

<!--popup Details Description-->
<ng-template #content6 let-c="close" let-d="dismiss">
  <div dir="{{getDirection()}}" [ngClass]="{'text-end': translate.currentLang === 'ar'}">
      <div class="modal-header py-2">
        <h4 class="modal-title">{{'task.description'| translate }}</h4>
        <button type="button" class="close ACM-modal-header-{{translate.currentLang}}" aria-label="Close"
          (click)="c(reset())">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="container p-3">
        <textarea [readonly]="true" [value]="editData.description" class="description-text-area"></textarea>
      </div>
      <div class="modal-footer py-1">
        <button class="mb-2 mx-2 btn btn-outline-danger" (click)="closePopup()">{{'button.cancel' | translate}}</button>
      </div>
  </div>
</ng-template>
