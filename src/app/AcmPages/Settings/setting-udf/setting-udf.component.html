<div class="card">
  <div class="card-header d-flex justify-content-between">
    <div>
      <i class="lnr-paw text-secondary pr-2"></i>
      {{ "setting.setting_udf" | translate }}
    </div>
    <div class="btn-actions-pane-right ACM-header-right-{{
        translate.currentLang
      }}">
      <button class="d-inline-flex align-items-center btn btn-primary" (click)="addGroup()">
        <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
        {{ "button.create_udf_groupe" | translate }}
      </button>
    </div>
  </div>

  <p-table #dt [responsive]="true" [autoLayout]="true" [value]="udfGroups" [lazy]="false" [lazyLoadOnInit]="false"
    sortMode="multiple" [rowsPerPageOptions]="[5, 10, 20, 50, 100]" [paginator]="true" [pageLinks]="5" [rows]="10"
    [columns]="selectedColumns">
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th *ngFor="let col of selectedColumns" [pSortableColumn]="col" class="text-center">
          <div class="center-elem text-center">
            <p-sortIcon [field]="col" class="pl-1"></p-sortIcon>
          </div>
        </th>
        <th style="width: 40px"></th>
        <th style="width: 40px"></th>
      </tr>
      <tr>
        <th *ngFor="let col of selectedColumns" [ngSwitch]="col">
          {{ col | titlecase}}
          <input *ngSwitchCase="'code'" class="form-control placeholder" type="text"
            (input)="dt.filter($event.target.value, col, 'contains')" />
          <input *ngSwitchCase="'description'" class="form-control" type="text"
            (input)="dt.filter($event.target.value, col, 'contains')" />
          <select *ngSwitchCase="'enabled'" class="form-control ACM-Dashbord-productDescription-col"
            (change)="dt.filter($event.target.value, col, 'equals')" [showClear]="true">
            <option value="">  {{ "category_loan.all" | translate }}</option>
            <option value="true">{{ "setting.on" | translate }}</option>
            <option value="false">{{ "setting.off" | translate }}</option>
          </select>
        </th>
        <th style="width: 40px"></th>
        <th style="width: 40px"></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData>
      <tr [pSelectableRow]="rowData">
        <td>{{ rowData.code }}</td>
        <td>{{ rowData.description }}</td>
        <td>
          <bSwitch [(ngModel)]="rowData.enabled" [switch-size]="'mini'" [switch-handle-width]="40"
            [switch-animate]="true" [switch-off-color]="'danger'" class="px-2 mb-0" (click)="openDialog(rowData)">
          </bSwitch>
        </td>

        <td>
          <button class="btn btn-warning text-white" (click)="editGroup(rowData)">
            <fa-icon [icon]="library.getIconDefinition('fas', 'pencil-alt')"></fa-icon>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<ng-template #addListModal let-modal>
  <div dir="{{ getDirection() }}" [ngClass]="{ 'text-end': translate.currentLang === 'ar' }">
    <div class="modal-header py-2">
      <h5 class="modal-title" *ngIf="updateId === 0">
        {{ "setting.udf.new_list" | translate }}
      </h5>
      <h5 class="modal-title" *ngIf="updateId !== 0">
        {{ "setting.udf.modify_list" | translate }}
      </h5>
      <button type="button" class="close ACM-modal-header-{{ translate.currentLang }}" (click)="modal.dismiss()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="card-body">
      <form class="form" [formGroup]="listForm">
        <div class="position-relative pb-4">
          <label> {{ "setting.code" | translate }}</label>
          <div class="input-group">
            <input type="text" class="form-control" formControlName="name" />
          </div>
        </div>
        <div class="position-relative pb-4">
          <label> {{ "setting.description" | translate }}</label>
          <div class="input-group">
            <textarea rows="3" cols="20" pInputTextarea class="form-control" formControlName="description">
            </textarea>
          </div>
        </div>
        <div class="position-relative pb-4">
          <label> Parent</label>
          <p-dropdown [options]="udfParentList" formControlName="parent"
              placeholder="Parent" optionLabel="label" [styleClass]="'full-width'"
              (onChange)="setParentListValues($event?.value)"></p-dropdown>
        </div>
      </form>
      <div class="position-relative pb-4">
        <div class="btn-actions-pane-right d-flex justify-content-between">
          <label> {{ "setting.udf.list_values" | translate }}</label>
          <button class="d-inline-flex align-items-center btn btn-primary ACM-header-right-{{
                translate.currentLang
              }}" (click)="addToListValues()">
            <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
            {{ "button.udf.add_list_values" | translate }}
          </button>
        </div>
        <div class="input-group">
          <p-table [value]="listValues" [tableStyle]="{ width: '100%' }">
            <ng-template pTemplate="header">
              <tr>
                <th>Label</th>
                <th>Description</th>
                <th>Parent</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
              <tr>
                <td>
                  <input type="text" class="form-control" [(ngModel)]="item.name" />
                </td>
                <td>
                  <input type="text" class="form-control" [(ngModel)]="item.description" />
                </td>
                <td>
                  <p-dropdown [options]="udfParentListValues" [(ngModel)]="item.parentUDFListValue"
                    placeholder="Parent" optionLabel="label" [styleClass]="'full-width'"></p-dropdown>
                </td>
                <td>
                  <button class="btn btn-danger" (click)="deleteFromListValues(rowIndex)">
                    <i class="pe-7s-trash btn-icon-wrapper text-white"></i>
                  </button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
      <div class="modal-footer py-1">
        <button class="mb-2 mx-2 btn btn-outline-danger" type="button" (click)="resetUDFListValue(); modal.dismiss()">
          {{ "button.cancel" | translate }}
        </button>
        <button class="mb-2 btn btn-primary" type="button" (click)="saveListValuesField();">
          {{ "button.save" | translate }}
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #modalContent let-modal>
  <div dir="{{ getDirection() }}" [ngClass]="{ 'text-end': translate.currentLang === 'ar' }">
    <div class="modal-header py-2">
      <h5 class="modal-title" *ngIf="updateId === 0">
        {{ 'udf.new-udf-group' | translate }}

      </h5>
      <h5 class="modal-title" *ngIf="updateId !== 0">
        {{ 'udf.modify-udf-group' | translate }}
      </h5>
      <button type="button" class="close ACM-modal-header-{{ translate.currentLang }}" (click)="modal.dismiss()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div>
      <p-accordion [activeIndex]="[0, 1]" [multiple]="true" class="w-full">
        <p-accordionTab>
          <ng-template pTemplate="header">
            <div class="flex align-items-center">

              <span class="vertical-align-middle">{{
                "setting.udf.group_details" | translate
                }}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="content">
            <form class="form" [formGroup]="udfGroupForm">
              <div class="position-relative pb-4">
                <div class="row">
                  <div class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "setting.code" | translate }}</label>
                    <div class="">
                      <input type="text" class="form-control" formControlName="code" />
                    </div>
                  </div>
                  <div class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "setting.description" | translate }}</label>
                    <div class="">
                      <input type="text" class="form-control" formControlName="description" />
                    </div>
                  </div>

                </div>
              </div>

              <div class="position-relative pb-4">
                <div class="row">
                  <div class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "setting.udf.udf-types" | translate }}</label>
                    <div class="">
                      <p-multiSelect [filter]="false" [options]="udfTypeOptions" formControlName="category"
                        [(ngModel)]="selectedCategories" [styleClass]="'full-width'"
                        placeholder="{{ 'udf.udf_group_code_default_udf' | translate }}" (ngModelChange)= "updateMultiSelectVisibility()"
                        optionLabel="label"></p-multiSelect>
                    </div>
                  </div>
                  <div *ngIf="displayMultiSelect" class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "loan_management.calculators.product" | translate }}</label>
                    <div  class="">
                      <p-multiSelect [filter]="false" [options]="products" [styleClass]="'full-width'"
                        formControlName="productId" [(ngModel)]="selectedProducts"
                        placeholder="{{ 'loan_management.calculators.product_code_default_select' | translate }}"
                        optionLabel="description" [required]="displayMultiSelect"></p-multiSelect>
                    </div>
                  </div>
                </div>
              </div>

              <div class="position-relative pb-4">
                <div class="row">
                  <div *ngIf="displayMultiSelectCustomer" class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "setting.udf.customer-type" | translate }}</label>
                    <div  class="">
                      <p-dropdown [options]="customerTypeOptions" formControlName="customerType"
                        [(ngModel)]="selectedCustomerType"
                        placeholder="{{ 'udf.udf_group_code_default_customer' | translate }}"
                        [styleClass]="'full-width'" optionLabel="label" [required]="displayMultiSelectCustomer"></p-dropdown>
                    </div>
                  </div>
                  <div class="col-xl-6 col-md-6 col-md-6 px-1">
                    <label>{{ "setting.udf.mandatory" | translate }}</label>
                    <div class="">
                      <bSwitch [switch-size]="'mini'" [switch-handle-width]="40" [switch-animate]="true"
                        formControlName="mondatory" [switch-off-color]="'danger'" class="px-2 mb-0">
                      </bSwitch>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </ng-template>
        </p-accordionTab>
        <p-accordionTab>
          <ng-template pTemplate="header">
            <div class="flex align-items-center">

              <span class="vertical-align-middle">{{  "setting.udf.udf-field" | translate }}</span>
            </div>
          </ng-template>
          <ng-template pTemplate="content">
            <div class="btn-actions-pane-right d-flex justify-content-between">
              <button class="d-inline-flex align-items-center btn btn-primary ACM-header-right-{{
                  translate.currentLang
                }}" (click)="addToListUDF()">
                <fa-icon class="mx-2" [icon]="library.getIconDefinition('fas', 'plus')"></fa-icon>
                {{ "button.udf.add_list_values" | translate }}
              </button>
            </div>
            <p-table [value]="listUDFField" [tableStyle]="{ width: '100%' }">
              <ng-template pTemplate="header">
                <tr>
                  <th>{{ 'setting.order' | translate }} </th>
                  <th>{{ "setting.code" | translate }}</th>
                  <th>{{ "setting.description" | translate }}</th>
                  <th>{{ "setting.udf.field_type" | translate }}</th>
                  <th>{{ "setting.udf.list_values" | translate }}</th>
                  <th></th>
                  <th>{{ "setting.udf.mandatory" | translate }}</th>
                  <th></th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
                <tr>
                  <td>
                    <input type="number" class="form-control" [(ngModel)]="item.ordre" required />
                  </td>
                  <td>
                    <input type="text" class="form-control" [(ngModel)]="item.name" required />
                  </td>
                  <td>
                    <input type="text" class="form-control" [(ngModel)]="item.description" required />
                  </td>
                  <td>
                    <p-dropdown [options]="fieldType"
                                [(ngModel)]="item.fieldTypeLabel"
                                placeholder="{{ 'setting.udf.select-a-field-type' | translate }}"
                                optionLabel="label"
                                [disabled]="item.fieldType !== 0">
                    </p-dropdown>
                  </td>
                  <td>
                    <input type="text" class="form-control" disabled [value]="item?.fieldListValuesDTOs?.length" />
                  </td>
                  <td>
                    <button [disabled]="listUDFField[rowIndex].fieldTypeLabel?.value !== 5" class="btn btn-warning"
                      (click)="addList(item, rowIndex)">
                      <i class="pe-7s-pen btn-icon-wrapper text-white"></i>
                    </button>
                  </td>
                  <td>
                    <bSwitch [(ngModel)]="item.mandatory" [switch-size]="'small'" [switch-animate]="true"
                      [ngModelOptions]="{ standalone: true }" [switch-off-color]="'danger'" class="px-2 mb-0"
                      (click)="disableUDF(item.code)"></bSwitch>
                  </td>
                  <td>
                    <button class="btn btn-danger" (click)="deleteFromListUDF(rowIndex)">
                      <i class="pe-7s-trash btn-icon-wrapper text-white"></i>
                    </button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
            <div class="modal-footer py-1">
              <button class="mb-2 mx-2 btn btn-outline-danger close" type="button" (click)="reset(); modal.dismiss()">
                {{ "button.cancel" | translate }}
              </button>
              <button (click)="saveUdfGroup()" class="mb-2 btn btn-primary" type="submit">
                {{ "button.save" | translate }}
              </button>
            </div>
          </ng-template>
        </p-accordionTab>
      </p-accordion>
    </div>
  </div>
</ng-template>
